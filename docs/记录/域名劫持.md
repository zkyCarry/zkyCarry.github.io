---
outline: deep
---

# 域名劫持
## DNS解析步骤
浏览器缓存->操作系统缓存(hosts)->本地DNS服务器->根DNS服务器->顶级域DNS服务器->权威DNS服务器
 <img src="/dns.jpg" style="max-width: 150%" />

## 原因
1. 本地运营商的DNS服务器被劫持，域名解析的ip地址，被指向第三方灰常网站，导致用户访问出问题。  
比如你在昌平被劫持，在朝阳没有被劫持。  
2. 特殊区域政府限制，比如新疆，政府会单独限制一些域名或者ip地址的访问。

## 表现：  
1. 部分手机会弹出证书错误，(因为访问的域名与真实访问不一致)。   
2. 网页载入失败

## 解决方案
1. 使用app内部封装的https请求(不使用webview自带的ajax)，内部请求可以使用自己的 httpDNS解析，不走公网的DNS解析。  
2. 使用备用域名，正常域名被劫持后，使用备用域名。
3. 电脑上访问手机端的页面，给用户提供 shell/批处理 脚本，更改用户电脑的hosts。从而让用户正常访问。(手机为了系统安全，不能更改hosts，除非越狱或者使用vpn)

## 内部 httpDNS解析
通过域名白名单，配置自己公司的域名，直接通过nginx负载均衡，返回可访问的ip地址。不需要dns解析。
